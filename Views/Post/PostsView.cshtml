@model List<WebApiHash.Models.Post>
<html>
<body>
    <div class="container">
        
        <br /><br /><br />
        Hashtag:
        <input class="form-control" id="hashtag" />
        <button onclick="openurl()">Klik klik beng</button>
     </div> 

    
  @section Scripts{
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="~/Scripts/jquery.signalR-2.2.2.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>

    <script type="text/javascript">
        $(function () {
        // Declare a proxy to reference the hub.
        var notifications = $.connection.postHub;

        //debugger;
        // Create a function that the hub can call to broadcast messages.
        notifications.client.updateMessages = function () {
            getAllMessages()

        };
        // Start the connection.
        $.connection.hub.start().done(function () {
            alert("connection started")
            getAllMessages();
        }).fail(function (e) {
            alert(e);
        });
    });


        function getAllMessages() {
            var tbl = $('#postListDiv');
            $.ajax({
                url: '/post/GetMessages',
                contentType: 'application/html ; charset:utf-8',
                type: 'GET',
                dataType: 'html',
                cache: false
            }).success(function (result) {
                tbl.empty().append(result);
                window.setTimeout(getAllMessages(), 5000)
            }).error(function () {

            });



            var BlockNumber = 2;  //Infinate Scroll starts from second block
            var NoMoreData = false;
            var inProgress = false;


            $(window).scroll(function () {
                if ($(window).scrollTop() == $(document).height() - $(window).height() && !NoMoreData && !inProgress) {

                    inProgress = true;
                    $("#loadingDiv").show();

                    $.post("@Url.Action("InfinateScroll", "Post")", { "BlockNumber": BlockNumber },
                            function (data) {

                                BlockNumber = BlockNumber + 1;
                                NoMoreData = data.NoMoreData;
                                $("#postListDiv").append(data.HTMLString);
                                $("#loadingDiv").hide();
                                inProgress = false;
                            });
                }
            });

        }
    </script>

}
    <div id="postListDiv">
        @{Html.RenderAction("PostList", "Post", new { Model = Model });}
    </div>
    <div id="loadingDiv" style="text-align: center; display: none; margin-bottom: 20px;">
        <img alt="Loading" src="@Url.Content("~/Images/ajax-loader.gif")" />
    </div>

</body>
</html>
