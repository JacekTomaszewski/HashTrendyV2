@model List<WebApiHash.Models.Post>
<html>
<body>
    <div class="container">

        <br /><br /><br />
        Hashtag:
        <input class="form-control" id="hashtag" />
        <button onclick="openurl()">Klik klik beng</button>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div id="messagesTable"></div>
        </div>
    </div>


    @section Scripts{
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="~/Scripts/jquery.signalR-2.2.2.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="/signalr/hubs"></script>

        <script type="text/javascript">

            var url = new URL(window.location.href);
            var GetUrl = '/post/GetMessages/?hashtagname=undefinedhashtagname6'
            if (url.searchParams.get("hashtagname") != null)
                GetUrl = '/post/GetMessages/?hashtagname=' + url.searchParams.get("hashtagname");
            $(function () {
                // Declare a proxy to reference the hub.
                var notifications = $.connection.postHub;

                //debugger;
                // Create a function that the hub can call to broadcast messages.
                notifications.client.updateMessages = function () {
                    getAllMessages()

                };
                // Start the connection.
                $.connection.hub.start().done(function () {
                    getAllMessages();
                }).fail(function (e) {
                    alert(e);
                });
            });


            function getAllMessages() {

                var tbl = $('#messagesTable');
                $.ajax({
                    url: GetUrl,
                    contentType: 'application/html ; charset:utf-8',
                    type: 'GET',
                    dataType: 'html',
                }).success(function (result) {
                    tbl.empty().append(result);
                    window.setTimeout(getAllMessages(), 5000)
                }).error(function () {

                });
            }
        </script>

    }
</body>
</html>
