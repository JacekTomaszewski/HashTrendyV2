@model List<WebApiHash.Models.Post>
<html>
<body>
    <div class="container">
        <br /><br /><br />
        <h1><font size="34">Popularne posty dla hashtaga: <div id="demo"></div></font></h1>

        Wyszukaj hashtaga:
        <input class="form-control" id="hashtag" /> <br />
        <button onclick="openurl()">Klik klik beng</button>
        <br /><br />
    </div>
    <br />

    <div class="row">
        <div class="col-md-12">
            <div id="messagesTable"></div>
        </div>
    </div>


        @section Scripts{
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

            <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
            <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
            <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
            <!--Reference the autogenerated SignalR hub script. -->
            <script src="~/Scripts/jquery.signalR-2.2.2.js"></script>
            <script src="/signalr/hubs"></script>

    <script type="text/javascript">
            $("#hashtag").autocomplete({
                source: '@Url.Action("Search","Post")'
            });

            function openurl() {
                var url = document.getElementById('hashtag').value;
                window.location.replace("/post/specificpostsview?hashtagname=" + url);
            }

                var url = new URL(window.location.href);
                document.getElementById("demo").innerHTML = '#' + url.searchParams.get("hashtagname");
            var GetUrl = '/post/GetMessages/?hashtagname=undefinedhashtagname6'
            if (url.searchParams.get("hashtagname") != null)
                GetUrl = '/post/GetMessages/?hashtagname='+url.searchParams.get("hashtagname");
            $(function () {
                // Declare a proxy to reference the hub.
                var notifications = $.connection.postHub;

                
                // Create a function that the hub can call to broadcast messages.
                notifications.client.updateMessages = function () {
                    getAllMessages();
                    getSpecificPosts();
                };
                // Start the connection.
                $.connection.hub.start().done(function () {
                    getAllMessages();
                    getSpecificPosts();
                }).fail(function (e) {
                    alert(e);
                });
            });



                function getSpecificPosts() {
                    
                    $.ajax({
                        url: '/post/GetSpecificPosts/?hashtagname=' + url.searchParams.get("hashtagname"),
                        contentType: 'application/html ; charset:utf-8',
                        type: 'GET',
                        dataType: 'html',
                    }).success(function (result) {
                        window.setTimeout(getSpecificPosts(), 5000)
                    }).error(function () {

                    });
                }


            function getAllMessages() {

                var tbl = $('#messagesTable');
                $.ajax({
                    url: GetUrl,
                    contentType: 'application/html ; charset:utf-8',
                    type: 'GET',
                    dataType: 'html',
                }).success(function (result) {
                    tbl.empty().append(result);
                    window.setTimeout(getAllMessages(), 5000)
                    window.setTimeout(getAllPosts(), 15000)
                }).error(function () {

                });
            }
            </script>

        }
</body>
</html>